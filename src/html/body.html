    <div class="loading-overlay" id="loadingOverlay"><div class="loader"></div></div>
    <audio id="notificationSound" preload="auto"><source src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYNjnFZAAAAAAAAAAAAAAAAAAAA" type="audio/mp3"></audio>

    <div class="app">
        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay"></div>

        <!-- Sidebar Wrapper -->
        <div class="sidebar-wrapper" id="sidebarWrapper">
            <div class="sidebar" id="sidebar">
                <!-- Sidebar scrollable content -->
                <div class="sidebar-content">
                    <!-- Logo -->
                    <div class="logo-section">
                        <div class="logo-icon">
                            <img src="https://static.wixstatic.com/media/65ccc7_382b4222d3644830a86f3e629bfcfdcb~mv2.png" alt="Tiny Panda" style="width: 28px; height: 28px; object-fit: contain;">
                        </div>
                        <div class="logo-text">
                            <div class="logo-title">Project Support Desk</div>
                            <div class="logo-subtitle">Tiny Panda</div>
                        </div>
                    </div>

                    <!-- Contract Card -->
                    <div class="contract-card" id="contractBanner">
                        <div class="contract-title" id="contractName">-</div>
                        <div class="contract-stats">
                            <div class="contract-stat">
                                <div class="contract-stat-value" id="baseTasks">0</div>
                                <div class="contract-stat-label">Contracted</div>
                            </div>
                            <div class="contract-stat">
                                <div class="contract-stat-value" id="adjustedTasks">0</div>
                                <div class="contract-stat-label">Available</div>
                            </div>
                        </div>
                        <div class="contract-progress" id="contractMonthly">
                            <div class="contract-progress-bar" id="monthlyProgressFill" style="width:0%"></div>
                        </div>
                        <div class="contract-footer"><span id="usedThisMonth">0</span> of <span id="monthlyLimit">0</span> used this month</div>
                        <div class="contract-mini">
                            <div class="contract-mini-value"><span class="contract-mini-used">0</span>/<span class="contract-mini-total">0</span></div>
                            <div class="contract-mini-label">used</div>
                        </div>
                    </div>

                    <!-- Ticket Types -->
                    <div class="section-label">Ticket Types</div>
                    <div class="type-tabs" id="ticketTypeTabs">
                        <button class="type-tab active ticket-type-tab" data-type="all">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M15 5v2"></path><path d="M15 11v2"></path><path d="M15 17v2"></path>
                                <path d="M5 5h14a2 2 0 0 1 2 2v3a2 2 0 0 0 0 4v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3a2 2 0 0 0 0-4V7a2 2 0 0 1 2-2z"></path>
                            </svg>
                            <span class="type-tab-label">All Tickets</span>
                            <span class="type-tab-count" id="allTypeCount">0</span>
                        </button>
                        <button class="type-tab support ticket-type-tab" data-type="support">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                                <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                            </svg>
                            <span class="type-tab-label">Support</span>
                            <span class="type-tab-count" id="supportTypeCount">0</span>
                        </button>
                        <button class="type-tab bug ticket-type-tab" data-type="bug">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m8 2 1.88 1.88"></path><path d="M14.12 3.88 16 2"></path>
                                <path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"></path>
                                <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"></path>
                                <path d="M12 20v-9"></path>
                                <path d="M6.53 9C4.6 8.8 3 7.1 3 5"></path><path d="M6 13H2"></path>
                                <path d="M3 21c0-2.1 1.7-3.9 3.8-4"></path><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"></path>
                                <path d="M22 13h-4"></path><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"></path>
                            </svg>
                            <span class="type-tab-label">Bugs</span>
                            <span class="type-tab-count" id="bugTypeCount">0</span>
                        </button>
                        <button class="type-tab project ticket-type-tab" data-type="project">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"></path>
                                <path d="M8 10v4"></path><path d="M12 10v2"></path><path d="M16 10v6"></path>
                            </svg>
                            <span class="type-tab-label">Projects</span>
                            <span class="type-tab-count" id="projectTypeCount">0</span>
                        </button>
                        <button class="type-tab referral ticket-type-tab" data-type="referral">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m11 17 2 2a1 1 0 1 0 3-3"></path>
                                <path d="m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4"></path>
                                <path d="m21 3 1 11h-2"></path>
                                <path d="M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3"></path><path d="M3 4h8"></path>
                            </svg>
                            <span class="type-tab-label">Referrals</span>
                            <span class="type-tab-count" id="referralTypeCount">0</span>
                        </button>
                    </div>

                    <!-- Quick Actions -->
                    <div class="section-label">Quick Actions</div>
                    <div class="quick-actions">
                        <button class="action-btn" id="rulesBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4"></path>
                                <path d="M19 17V5a2 2 0 0 0-2-2H4"></path>
                            </svg>
                            <span class="action-btn-label">Rules</span>
                        </button>
                        <button class="action-btn" id="taskHistoryBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="20" x2="12" y2="10"></line>
                                <line x1="18" y1="20" x2="18" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="16"></line>
                            </svg>
                            <span class="action-btn-label">Task History</span>
                        </button>
                        <button class="action-btn" id="feedbackBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span class="action-btn-label">Feedback</span>
                        </button>
                        <div class="notification-wrapper">
                            <button class="action-btn" id="notificationBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
                                    <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path>
                                </svg>
                                <span class="action-btn-label">Notifications</span>
                                <span class="action-badge hidden" id="notificationBadge">0</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- User Account - Fixed at bottom -->
                <div class="user-account glass-card" id="userInfo">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div class="user-info-text">
                        <div class="user-name" id="userName">Loading...</div>
                    </div>
                    <span class="user-dropdown">â–¼</span>
                </div>
                <!-- Account Dropdown -->
                <div class="account-dropdown" id="accountDropdown">
                    <div class="account-dropdown-header" id="accountUserName">Account</div>
                    <button class="account-dropdown-item" id="accountBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Account Settings
                    </button>
                    <button class="account-dropdown-item" id="logoutBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>

            <!-- Collapse button -->
            <button class="collapse-btn" id="collapseBtn" title="Toggle sidebar">
                <svg id="collapseIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 7l-4 5 4 5"></path>
                    <path d="M17 7l-4 5 4 5"></path>
                </svg>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <header class="header glass">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <h1 class="header-title">Tickets</h1>
                    <span class="live-indicator" id="liveIndicator" style="display: none;">Live</span>
                </div>
                <!-- Company Branding (shown when profile has company) -->
                <div class="header-branding" id="headerCenter" style="display: none;">
                    <img class="company-logo" id="companyLogo" src="" alt="Company Logo" style="display: none;">
                    <div class="company-name" id="companyName"></div>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search tickets...">
                    </div>
                    <div class="header-buttons">
                        <div class="header-btn-group">
                            <button class="header-btn pacman" id="pacmanBtn">
                                <img src="https://static.wixstatic.com/media/65ccc7_953f1c7576724572800deed9cdf2957b~mv2.png" alt="Pacman" style="width: 20px; height: 20px;">
                            </button>
                            <span class="header-btn-label">Pacman</span>
                        </div>
                        <div class="header-btn-group">
                            <button class="header-btn project" id="projectBtn" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"></path>
                                </svg>
                            </button>
                            <span class="header-btn-label">Project</span>
                        </div>
                        <div class="header-btn-group">
                            <button class="header-btn branding" id="brandingBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="13.5" cy="6.5" r=".5"></circle><circle cx="17.5" cy="10.5" r=".5"></circle>
                                    <circle cx="8.5" cy="7.5" r=".5"></circle><circle cx="6.5" cy="12.5" r=".5"></circle>
                                    <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"></path>
                                </svg>
                            </button>
                            <span class="header-btn-label">Branding</span>
                        </div>
                    </div>
                    <button class="new-ticket-btn" id="newTicketBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        <span>New Ticket</span>
                    </button>
                </div>
            </header>

            <!-- Profile Setup Banner -->
            <div class="profile-setup-banner" id="profileSetupBanner" style="display: none;">
                <div class="profile-setup-content">
                    <div class="profile-setup-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <div class="profile-setup-text">
                        <strong>Complete your profile</strong>
                        <span>Please enter your name and company to continue</span>
                    </div>
                    <div class="profile-setup-form">
                        <input type="text" id="profileNameInput" placeholder="Your Name" class="profile-input">
                        <input type="text" id="profileCompanyInput" placeholder="Company Name" class="profile-input">
                        <button class="btn btn-primary" id="saveProfileBtn">Save Profile</button>
                    </div>
                </div>
            </div>

            <!-- Access Denied -->
            <div class="access-denied" id="accessDenied" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
                <h2>Access Denied</h2>
                <p id="accessDeniedMessage">Your email is not registered in the system. Please contact the administrator.</p>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Fixed content above grid -->
                <div class="content-fixed">
                    <!-- Stats Row -->
                    <div class="stats-row" id="statsBar">
                        <div class="stat-card glass-card">
                            <div class="stat-icon pink">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M15 5v2"></path><path d="M15 11v2"></path><path d="M15 17v2"></path>
                                    <path d="M5 5h14a2 2 0 0 1 2 2v3a2 2 0 0 0 0 4v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3a2 2 0 0 0 0-4V7a2 2 0 0 1 2-2z"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="stat-label">Total Tickets</div>
                                <div class="stat-value pink" id="totalTickets">0</div>
                            </div>
                        </div>
                        <div class="stat-card glass-card">
                            <div class="stat-icon blue">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                </svg>
                            </div>
                            <div>
                                <div class="stat-label">Open</div>
                                <div class="stat-value blue" id="openTickets">0</div>
                            </div>
                        </div>
                        <div class="stat-card glass-card">
                            <div class="stat-icon orange">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line>
                                    <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                                    <line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line>
                                    <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
                                </svg>
                            </div>
                            <div>
                                <div class="stat-label">In Progress</div>
                                <div class="stat-value orange" id="inProgressTickets">0</div>
                            </div>
                        </div>
                        <div class="stat-card glass-card">
                            <div class="stat-icon green">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                            </div>
                            <div>
                                <div class="stat-label">Resolved</div>
                                <div class="stat-value green" id="resolvedTickets">0</div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Tabs & Filters -->
                    <div class="status-tabs-row">
                        <div class="status-tabs glass-dark" id="statusTabs">
                            <button class="status-tab tab active" data-tab="all">All Tickets</button>
                            <button class="status-tab tab" data-tab="open">Open</button>
                            <button class="status-tab tab" data-tab="in-progress">In Progress</button>
                            <button class="status-tab tab" data-tab="resolved">Resolved</button>
                        </div>
                        <div class="filters-row">
                            <select class="filter-select" id="priorityFilter">
                                <option value="">All Priorities</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                            <select class="filter-select" id="userFilter" style="display: none;">
                                <option value="">All Users</option>
                            </select>
                            <select class="filter-select" id="companyFilter" style="display: none;">
                                <option value="">All Companies</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Main Grid -->
                <div class="main-grid">
                    <!-- Ticket List Column -->
                    <div class="ticket-list-column">
                        <div class="ticket-list glass-card" id="ticketList">
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"></path>
                            </svg>
                            <h3>No tickets yet</h3>
                            <p>Create your first ticket to get started</p>
                        </div>
                    </div>
                    </div>

                    <!-- Mobile Back Button -->
                    <button class="mobile-back-btn" id="mobileBackBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5"></path>
                            <path d="M12 19l-7-7 7-7"></path>
                        </svg>
                        Back to Tickets
                    </button>

                    <!-- Ticket Detail -->
                    <div class="ticket-detail-panel glass-card" id="ticketDetailPanel">
                        <div class="empty-state" id="noTicketSelected">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <h3>Select a ticket</h3>
                            <p>Choose a ticket from the list to view details</p>
                        </div>
                        <div class="ticket-detail-content" id="ticketDetailContent" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- No Tasks Warning -->
    <div class="no-tasks-warning" id="noTasksWarning" style="display: none;">
        You have reached your monthly task limit. Please contact support for additional tasks.
    </div>

    <!-- New Ticket Modal -->
    <div class="modal-overlay" id="newTicketModal">
        <div class="modal glass-card">
            <div class="modal-header">
                <h2 class="modal-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>Create New Ticket</span>
                </h2>
                <button class="modal-close" id="closeModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="ticketForm">
                    <!-- Ticket Type Selector -->
                    <div class="form-group">
                        <label class="form-label">What type of request is this? <span class="required">*</span></label>
                        <div class="ticket-type-selector" id="ticketTypeSelector">
                            <div class="type-option selected" data-type="support">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                                    <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                                </svg>
                                <div class="type-option-title">Support</div>
                                <div class="type-option-desc">Help with existing features</div>
                            </div>
                            <div class="type-option" data-type="bug">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="m8 2 1.88 1.88"></path><path d="M14.12 3.88 16 2"></path>
                                    <path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"></path>
                                    <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"></path>
                                </svg>
                                <div class="type-option-title">Bug Report</div>
                                <div class="type-option-desc">Something isn't working (FREE)</div>
                            </div>
                            <div class="type-option" data-type="project">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"></path>
                                </svg>
                                <div class="type-option-title">New Project</div>
                                <div class="type-option-desc">Request new development</div>
                            </div>
                            <div class="type-option" data-type="referral">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="m11 17 2 2a1 1 0 1 0 3-3"></path>
                                    <path d="m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4"></path>
                                </svg>
                                <div class="type-option-title">Referral</div>
                                <div class="type-option-desc">Refer a company</div>
                            </div>
                        </div>
                    </div>

                    <!-- Referral Fields -->
                    <div id="referralFieldsGroup" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Company Being Referred <span class="required">*</span></label>
                            <input type="text" id="referralCompanyName" class="form-input" placeholder="Company name">
                            <div class="field-error" id="referralCompanyError">Company name is required</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact Email <span class="required">*</span></label>
                            <input type="email" id="referralEmailAddress" class="form-input" placeholder="contact@company.com">
                            <div class="field-error" id="referralEmailError">Valid email address is required</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone (Optional)</label>
                            <input type="text" id="referralPhoneNumber" class="form-input" placeholder="+44 123 456 7890">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Comment (Optional)</label>
                            <textarea id="referralCommentText" class="form-textarea" style="min-height: 80px;" placeholder="Any additional information..."></textarea>
                        </div>
                    </div>

                    <!-- Category (Support only) -->
                    <div class="form-group" id="categoryFormGroup">
                        <label class="form-label">Category</label>
                        <div class="category-grid" id="categoryGrid">
                            <div class="category-card" data-category="other">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                                </svg>
                                <div class="category-card-title">Custom / Type your own</div>
                            </div>
                            <div class="category-card" data-category="domains">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                </svg>
                                <div class="category-card-title">Domains & Account</div>
                            </div>
                            <div class="category-card" data-category="billing">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                    <line x1="1" y1="10" x2="23" y2="10"></line>
                                </svg>
                                <div class="category-card-title">Plans & Billing</div>
                            </div>
                            <div class="category-card" data-category="payments">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="1" x2="12" y2="23"></line>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                                <div class="category-card-title">Payments</div>
                            </div>
                            <div class="category-card" data-category="marketing">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                </svg>
                                <div class="category-card-title">Marketing & SEO</div>
                            </div>
                            <div class="category-card" data-category="stores">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                </svg>
                                <div class="category-card-title">Wix Stores</div>
                            </div>
                            <div class="category-card" data-category="memberships">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                <div class="category-card-title">Memberships & Events</div>
                            </div>
                            <div class="category-card" data-category="velo">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="16 18 22 12 16 6"></polyline>
                                    <polyline points="8 6 2 12 8 18"></polyline>
                                </svg>
                                <div class="category-card-title">Velo & CMS</div>
                            </div>
                            <div class="category-card" data-category="content">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="3" y1="9" x2="21" y2="9"></line>
                                    <line x1="9" y1="21" x2="9" y2="9"></line>
                                </svg>
                                <div class="category-card-title">Content / Design</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" id="subjectFormGroup">
                        <label class="form-label">Subject <span class="required">*</span></label>
                        <input type="text" id="ticketSubject" class="form-input" placeholder="Brief description of your issue">
                        <div class="field-error" id="subjectError">Subject is required (min 5 characters)</div>
                    </div>

                    <div class="form-group" id="descriptionFormGroup">
                        <label class="form-label">Description <span class="required">*</span></label>
                        <textarea id="ticketDescription" class="form-textarea" placeholder="Please provide as much detail as possible..."></textarea>
                        <div class="field-error" id="descriptionError">Description is required (min 10 characters)</div>
                    </div>

                    <div class="form-group" id="priorityFormGroup">
                        <label class="form-label">Priority</label>
                        <div class="priority-selector" id="prioritySelector">
                            <div class="priority-option low" data-priority="low">Low</div>
                            <div class="priority-option medium selected" data-priority="medium">Medium</div>
                            <div class="priority-option high" data-priority="high">High</div>
                            <div class="priority-option urgent" data-priority="urgent">Urgent</div>
                        </div>
                    </div>

                    <div class="form-group" id="impactFormGroup">
                        <label class="form-label">Business Impact</label>
                        <div class="impact-selector" id="impactSelector">
                            <div class="impact-option none" data-impact="none">None</div>
                            <div class="impact-option minor" data-impact="minor">Minor</div>
                            <div class="impact-option moderate selected" data-impact="moderate">Moderate</div>
                            <div class="impact-option major" data-impact="major">Major</div>
                            <div class="impact-option critical" data-impact="critical">Critical</div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTicket">Cancel</button>
                <button class="btn btn-primary" id="submitTicket">
                    <span class="btn-text">Create Ticket</span>
                    <span class="btn-loader" style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Popup (modal overlay) -->
    <div class="modal-overlay notification-popup-overlay" id="notificationPopup">
        <div class="modal glass-card notification-popup-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
                        <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path>
                    </svg>
                    <span>Notifications</span>
                </h3>
                <div class="notification-popup-actions">
                    <button class="notification-clear-btn" id="clearAllNotifications">Clear All</button>
                    <button class="modal-close" id="closeNotificationPopup">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="notification-list" id="notificationList">
                    <div class="notification-empty">No new notifications</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rules Popup -->
    <div class="modal-overlay rules-popup-overlay" id="rulesPopup">
        <div class="modal glass-card rules-popup-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4"></path>
                        <path d="M19 17V5a2 2 0 0 0-2-2H4"></path>
                    </svg>
                    <span>Contract Rules</span>
                </h3>
                <button class="modal-close" id="closeRulesPopup">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="rulesPopupBody">
                <!-- Populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Task History Popup -->
    <div class="modal-overlay task-history-overlay" id="taskHistoryPopup">
        <div class="modal glass-card task-history-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="20" x2="12" y2="10"></line>
                        <line x1="18" y1="20" x2="18" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="16"></line>
                    </svg>
                    <span>Task History</span>
                </h3>
                <button class="modal-close" id="closeTaskHistoryPopup">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="taskHistoryPopupBody">
                <div style="text-align:center;padding:40px;color:#94a3b8;">Loading task history...</div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="image-modal" id="imageModal">
        <img src="" alt="Full size image" id="imageModalImg">
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>
